title: Добавляем панорамы на Google Maps
-
author: Алексей Пушкарёв
-
short-content: Пошаговое руководство по добавлению уже готовых панорам в сервис Google Maps.
-
content:

Вступление
----------

Виртуальные панорамы это одно из новых медиа, которое спустя 20 лет развития технологии начало обретать массовую популярность. Первым важным этапом на этом пути было появление социального сервиса для публикации, всем известного 360cities.net. Вторым этапом стала возможность снимать панорамы с помощью смартфонов, созданная Google для своей платформы Android. Простота съёмки и публикации панорам в картах придала широкую популярность новому сервису и привлекла профессионалов панорамной съёмки.

Если для пользователей смартфонов процесс упрощён до предела, то публикация уже готовых панорам требует освоения незнакомой экосистемы сервисов Google, которая иногда заставляла напрячь голову и искать ответы на возникшие вопросы в интернете. Эта статья пошагово описывает процесс публикации панорамы на картах Google, расширенный по отношению к [официальному руководству](https://support.google.com/maps/answer/2839084).

I. Подготовка панорам
----------

Существуют ограничения, накладываемые на изображения, которые можно публиковать:<br />
• изображения передаются в формате jpeg,<br />
• максимально допустимый вес загружаемого изображения — 50 мегабайт,<br />
• тип проекции панорамы — только equirectangular, другие проекции не поддерживаются.<br />

По опыту, чтобы уложиться в ограничение по весу, оптимальным будет размер панорамы с полной сферой в 10000 на 5000 точек, а качество сжатия JPG 85%. Размер сжатых панорам лежит в диапазоне 10-35 мегабайт.

Финальным этапом в подготовке панорамы будет шарпенинг. По опыту, лучше применять повышение резкости чуть сильнее обычного на вкус цветокорректора. Загруженные на сервер панорамы преобразовываются в стороны куба достаточно качественно, так что добиться звенящей картинки вполне реально. Для панорам в самом сервисе рассчитывается минимальный угол обзора так, чтобы изображение показывалось пиксель в пиксель.

II. Загрузка панорамы на сервер
----------


Для загрузки панорам требуется наличие аккаунта в экосистеме Google, а сама загрузка осуществляется через сервис Google+. 
Перед загрузкой необходимо [в настройках своего аккаунта](https://plus.google.com/settings?hl=ru) включить чекбокс «Загружать фото в полном размере».

Этот сервис уже позволяет отображать виртуальные панорамы и управлять ими по одной, но, чтобы он распознал загруженное изображение как панораму, в файл необходимо добавить метаданные. Для добавления метаданных доступны два способа:<br />
1. Воспользоваться [этим сайтом](http://photo-sphere.appspot.com/), загрузить в него изображение панорамы и получить обратно файл с прописанными метаданными,<br />
2. Записать метаданные вручную.<br />

Первый вариант имеет серьёзное ограничение на размер панорамы, около 2500 на 1250 точек, а картинки большего размера не обрабатываются. Возможно, это будет исправлено в будущем.

Для второго варианта существует [специальное руководство](https://developers.google.com/photo-sphere/metadata/?hl=ru), которое описывает XMP-спецификацию метаданных. Там приведён готовый пример, который можно переправить под себя, сохранить в формате xmp и попробовать добавить, например, в Photoshop. Необходимо открыть свойства файла File → File Info или комбинацией клавиш Alt+Ctrl+Shift+i:

<center><img src="@path/1.jpg" width="800px" height="435px"><br />
	Рис. 1. Окно редактирования метаданных</center>
	
Импортируем файл метаданных (кнопка Import, доступна в выпадающем списке). Однако, импорт закончится ошибкой. :) Причина — спецификация не соответствует формату, который понимает Photoshop. Требуется обёртка из метатегов, верный вариант дан ниже:
<pre>
	&#60;?xpacket?&#62;
		&#60;x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="Adobe XMP Core 5.3-c011 66.145661, 2012/02/06-14:56:27"&#62;
			&#60;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&#62;
				&#60;rdf:Description rdf:about="" xmlns:GPano="http://ns.google.com/photos/1.0/panorama/"&#62;
					&#60;GPano:UsePanoramaViewer&#62;True&#60;/GPano:UsePanoramaViewer&#62;
					&#60;GPano:CaptureSoftware&#62;Photo Sphere&#60;/GPano:CaptureSoftware&#62;
					&#60;GPano:StitchingSoftware&#62;Photo Sphere&#60;/GPano:StitchingSoftware&#62;
					&#60;GPano:ProjectionType&#62;equirectangular&#60;/GPano:ProjectionType&#62;
					&#60;GPano:PoseHeadingDegrees&#62;350.0&#60;/GPano:PoseHeadingDegrees&#62;
					&#60;GPano:InitialViewHeadingDegrees&#62;90.0&#60;/GPano:InitialViewHeadingDegrees&#62;
					&#60;GPano:InitialViewPitchDegrees&#62;0.0&#60;/GPano:InitialViewPitchDegrees&#62;
					&#60;GPano:InitialViewRollDegrees&#62;0.0&#60;/GPano:InitialViewRollDegrees&#62;
					&#60;GPano:InitialHorizontalFOVDegrees&#62;75.0&#60;/GPano:InitialHorizontalFOVDegrees&#62;
					&#60;GPano:CroppedAreaLeftPixels&#62;0&#60;/GPano:CroppedAreaLeftPixels&#62;
					&#60;GPano:CroppedAreaTopPixels&#62;0&#60;/GPano:CroppedAreaTopPixels&#62;
					&#60;GPano:CroppedAreaImageWidthPixels&#62;10000&#60;/GPano:CroppedAreaImageWidthPixels&#62;
					&#60;GPano:CroppedAreaImageHeightPixels&#62;5000&#60;/GPano:CroppedAreaImageHeightPixels&#62;
					&#60;GPano:FullPanoWidthPixels&#62;10000&#60;/GPano:FullPanoWidthPixels&#62;
					&#60;GPano:FullPanoHeightPixels&#62;5000&#60;/GPano:FullPanoHeightPixels&#62;
					&#60;GPano:FirstPhotoDate&#62;2013-16-12T18:03:13.0Z&#60;/GPano:FirstPhotoDate&#62;
					&#60;GPano:LastPhotoDate&#62;2012-11-07T18:10:10.0Z&#60;/GPano:LastPhotoDate&#62;
					&#60;GPano:SourcePhotosCount&#62;6&#60;/GPano:SourcePhotosCount&#62;
					&#60;GPano:ExposureLockUsed&#62;False&#60;/GPano:ExposureLockUsed&#62;
				&#60;/rdf:Description&#62;
			&#60;/rdf:RDF&#62;
		&#60;/x:xmpmeta&#62;
	&#60;?xpacket end="w"?&#62;
</pre>

Нужно сохранить этот файл в формате *.xmp в папку C:\Users\имя пользователя компьютера\AppData\Roaming\Adobe\XMP\Metadata Templates (для Windows 7). Photoshop всегда предлагает импортировать и экспортировать данные в папку по умолчанию, так что в других системах вы не потеряетесь. Кроме того, уже импортированные файлы появляются в выпадающем меню на кнопке импорта для более быстрого доступа.

После импорта метаданных, изображение можно сохранить. Чтобы добавить изображение, нужно загрузить его как обычную фотографию в свою ленту Google+.

<center><img src="@path/2.jpg" width="385px" height="209px"><br />
	Рис. 1. Форма создания новой записи в Google+</center>

Также, создать новую запись можно, нажав на кнопку «+» в правом верхнем углу экрана.
После загрузки и обработки панораму можно будет публиковать и просматривать в своей ленте.

III. Публикация панорамы в сервисе «Фототуры»
----------

Напрямую попасть из Google+ на свой профиль в фототурах не получится, и в меню этот пункт искать долго. Так что даю прямую ссылку: [https://www.google.com/maps/views/home?gl=ru](https://www.google.com/maps/views/home?gl=ru). Чтобы попасть в профиль, необходимо кликнуть по своей аватарке в верхнем правом углу экрана.

В том же углу экрана находится кнопка добавления панорам из Google+. Процесс добавления достаточно прост: можно выбрать множество файлов (потом нажать на кнопку «Выбрать», указать по карте их местоположение и добавить описание, нажать на «Отправить»).

После этого панорамы появятся в профиле. Чтобы объединить их в тур, нужно нажать на кнопку «Выбрать снимки», отметить нужное, нажать «Объединить снимки». После чего, следуя советам, расставляем направления панорам и указываем связи между ними.

Остаётся только опубликовать, после чего тур будет доступен всем.